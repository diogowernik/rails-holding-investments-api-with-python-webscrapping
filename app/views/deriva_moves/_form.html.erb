<%= form_with(model: deriva_move, local: true) do |form| %>
  <% if deriva_move.errors.any? %>
    <div id="error_explanation">
      <h2><%= pluralize(deriva_move.errors.count, "error") %> prohibited this deriva_move from being saved:</h2>

      <ul>
      <% deriva_move.errors.full_messages.each do |message| %>
        <li><%= message %></li>
      <% end %>
      </ul>
    </div>
  <% end %>

<div class="row">
  <div class="col-md-4 mt-4">
    <%= form.label :carteira_id %> <%= link_to new_carteira_path do %> &nbsp; <small> (Nova)</small> <% end %>
    <%= form.select :carteira_id, Carteira.all.collect {|d| [d.nome, d.id]}, {}, {class: 'form-control'} %>
  </div>

  <div class="col-md-4 mt-4">
    <%= form.label :corretora_id %> <%= link_to new_corretora_path do %> &nbsp; <small> (Nova)</small> <% end %>
    <%= form.select :corretora_id, Corretora.all.collect {|d| [d.nome, d.id]}, {}, {class: 'form-control'} %>
  </div>

  <div class="col-md-4 mt-4">
    <%= form.label :estado_id %> <%= link_to new_estado_path do %> &nbsp; <small> (Novo)</small> <% end %>
    <%= form.select :estado_id, Estado.all.collect {|d| [d.status, d.id]}, {}, {class: 'form-control'} %>
  </div>
  
  <div class="col-md-4 mt-4">
    <%= form.label :investimento_id %> <%= link_to new_investimento_path do %> &nbsp; <small> (Novo)</small> <% end %>
    <%= form.select :investimento_id, Investimento.all.collect {|d| [d.custom_invest, d.id]}, {}, {class: 'form-control'} %>
  </div>

  <div class="col-md-2 mt-4"> 
    <label>Filtro (Ativo Base)</label>
    <input type="text" class="form-control" placeholder="Ex: BBAS" maxlength="4" id="derivativo_filter"/>
  </div>

  <div class="col-md-2 mt-4"> <%= link_to new_derivativo_path do %> &nbsp; <small> (Novo)</small> <% end %>
    <%= form.label :derivativo_id %>
    <%= form.select :derivativo_id, Derivativo.all.order("codigo asc").collect {|d| [d.codigo, d.id]}, {}, {class: 'form-control'} %>
  </div>
  
  <div class="col-md-4 mt-4">
    <%= form.label :movimento %>
    <%= form.select :movimento, [["Venda","Venda"], ["Compra","Compra"]], {}, {class: 'form-control'} %>
  </div>

  <div class="col-md-4 mt-4">
    <%= form.label :valor %>
    <%= form.text_field :valor, :required => true, class: 'form-control'  %>
  </div>

  <div class="col-md-4 mt-4">
    <%= form.label :quantidade %>
    <%= form.number_field :quantidade, :required => true,  class: 'form-control' %>
  </div>
  <div class="col-md-4 mt-4">
    <%= form.label :resultado %>
    <%= form.number_field :resultado, class: 'form-control' %>
  </div>
  <div class="col-md-4 mt-4 mb-3">
    <%= form.label :data %> de Negociação</br>
    <%= form.date_select :data %>
  </div>
</div>
<div id="accordion">
   <div class="card card-default mb-1 mt-4">
      <div class="card-header" id="headingOne">
         <h4 class="mb-0"><a class="text-inherit" data-toggle="collapse" data-target="#collapseOne" aria-expanded="true" aria-controls="collapseOne" href="">Em caso de recompra</a></h4>
      </div>
      <div class="collapse" id="collapseOne" aria-labelledby="headingOne" data-parent="#accordion" style="">
         <div class="card-body border-top">
            <div class="row">  
              <div class="col-md-5 mt-4">
                <%= form.label :valor_recompra %>
                <%= form.text_field :valor_recompra, class: 'form-control' %>
              </div>
              <div class="col-md-5 mt-4">
                <%= form.label :data_recompra %></br>
                <%= form.date_select :data_recompra %>
              </div>
            </div>
         </div>
      </div>
   </div>
</div>


<div class="row">
	<div class="col-md-3 mt-4">
		<div class="form-group">
			<%= form.submit 'Enviar', class: 'btn btn-block btn-primary' %>
		</div>
	</div>
</div>
<% end %>

<!--Jquery para calcular o resultado usar no caso de abertas ou pó.-->
<script>
$(document).ready(function(){
    $('#deriva_move_valor').keyup(calculate);
    $('#deriva_move_quantidade').keyup(calculate);
});
function calculate(e)
{
    $('#deriva_move_resultado').val($('#deriva_move_valor').val() * $('#deriva_move_quantidade').val());
}
</script>





<script>
// jquery para filtrar derivativos
$('#derivativo_filter').keyup(function () {
      var valthis = $(this).val().toLowerCase();
      var num = 0;
      $('select#deriva_move_derivativo_id>option').each(function () {
          var text = $(this).text().toLowerCase();
          if(text.indexOf(valthis) !== -1)  
              {$(this).show(); $(this).prop('selected',true);}
          else{$(this).hide();}
           });
});

$('#derivativo_filter').keyup(function () {
      var valthis = $(this).val().toLowerCase();
      var num = 0;
      $('select#deriva_move_investimento_id>option').each(function () {
          var text = $(this).text().toLowerCase();
          if(text.indexOf(valthis) !== -1)  
              {$(this).show(); $(this).prop('selected',true);}
          else{$(this).hide();}
           });
});

</script>

