<%= render partial: "carteiras/navbar" %>

<div class="float-right"><%= link_to new_investimento_path do %>
	<button class="btn btn-outline-success">
		<em class="fa fa-plus-circle"></em> &nbsp; Novo Investimento
	</button><% end %>
</div>

<h3 class="h3-custom mb-4" id="minhas-paginas">
	Mov. de Derivativos
</h3>



<h3 class="h4 mt-3" id="minhas-paginas">
	Ações
</h3>

<div class="row">
    <div class="col-md-3 mt-4">
        <div class="card">
               <div class="card-body">
                   <h4 class="m-0">Alguma Info aqui
                   
                   </h4>
               </div>
               <div class="card-body">
                  
               </div>
        </div>
        
    </div>
    <div class="col-md-9 mt-4">
        <div class="card"><div class="card-body">
            <div class="table-responsive">
            	<table class="table table-striped table-bordered table-hover">
                  <thead class="text-center">
                    <tr>
                      <th>Ano</th>
                      <th>Jan</th>
                      <th>Fev</th>
                      <th>Mar</th>
                      <th>Abr</th>
                      <th>Mai</th>
                      <th>Jun</th>
                      <th>Jul</th>
                      <th>Ago</th>
                      <th>Set</th>
                      <th>Out</th>
                      <th>Nov</th>
                      <th>Dez</th>
                      <th>Total</th>
                      <th colspan="1"></th>
                    </tr>
                  </thead>
                  <tbody class="text-center">
                    <% @sinteticos.where(:carteira_id => @carteira.id).each do |sintetico| %>
                      <tr>
                        <td><%= sintetico.ano.ano %>
                        </td>
                       <td style="width: 82px"><%= number_to_currency(sintetico.jan , unit: "", separator: ",", delimiter: ".", strip_insignificant_zeros: true) %></td>
                       <td style="width: 82px"><%= number_to_currency(sintetico.fev , unit: "", separator: ",", delimiter: ".", strip_insignificant_zeros: true) %></td>
                       <td style="width: 82px"><%= number_to_currency(sintetico.mar , unit: "", separator: ",", delimiter: ".", strip_insignificant_zeros: true) %></td>
                       <td style="width: 82px"><%= number_to_currency(sintetico.abr , unit: "", separator: ",", delimiter: ".", strip_insignificant_zeros: true) %></td>
                       <td style="width: 82px"><%= number_to_currency(sintetico.mai , unit: "", separator: ",", delimiter: ".", strip_insignificant_zeros: true) %></td>
                       <td style="width: 82px"><%= number_to_currency(sintetico.jun , unit: "", separator: ",", delimiter: ".", strip_insignificant_zeros: true) %></td>
                       <td style="width: 82px"><%= number_to_currency(sintetico.jul , unit: "", separator: ",", delimiter: ".", strip_insignificant_zeros: true) %></td>
                       <td style="width: 82px"><%= number_to_currency(sintetico.ago , unit: "", separator: ",", delimiter: ".", strip_insignificant_zeros: true) %></td>
                        <td style="width: 82px"><%= number_to_currency(sintetico.set, unit: "", separator: ",", delimiter: ".", strip_insignificant_zeros: true) %></td>
                        <td style="width: 82px"><%= number_to_currency(sintetico.out, unit: "", separator: ",", delimiter: ".", strip_insignificant_zeros: true) %></td>
                        <td style="width: 82px"><%= number_to_currency(sintetico.nov, unit: "", separator: ",", delimiter: ".", strip_insignificant_zeros: true) %></td>
                        <td style="width: 82px"><%= number_to_currency(sintetico.dez, unit: "", separator: ",", delimiter: ".", strip_insignificant_zeros: true) %></td>
                        <td style="width: 82px"><%= number_to_currency(sintetico_anual(sintetico), unit: "", separator: ",", delimiter: ".", strip_insignificant_zeros: true) %></td>
                        <td>
                            <%= link_to edit_sintetico_path(sintetico) do %><em class="fa fa-pencil"></em><% end %>
                        </td>
                       </tr>
                    <% end %>
                     
                  </tbody>
                </table>
            </div>
        </div></div>
        <div id="accordion">
        <% @vencimentos.order("created_at desc").each do |vencimento| %>
            <% if @deriva_moves.where(:vencimento_id => vencimento.id).sum(:resultado) != 0 %>
            
            
            <div class="card card-default mb-1">
                  <div class="card-header" id="<%= vencimento.id %>">
                     <h4 class="mb-0">
                         <a class="text-inherit collapsed" data-toggle="collapse" data-target="#collapseOne" aria-expanded="true" aria-controls="collapseOne" href="">
                         <%= vencimento.data.strftime("%m / %Y") %>
                           <small class="text-primary float-right mr-1">
                               <b>
                                   <%= number_to_currency(@deriva_moves.where(:vencimento_id => vencimento.id).sum(:resultado), unit: "R$ ", separator: ",", delimiter: ".", strip_insignificant_zeros: true) %>
                                </b>
                           </small> 
                           <small class="text-muted float-right mr-2">Resultado: </small>
                         </a>
                         </h4>
                  </div>
                  <div class="collapsed collapse" id="collapseOne" aria-labelledby="headingOne" data-parent="#accordion" style="">
                     <div class="card-body border-top">
                         <div class="table-responsive">
                            <table class="table table-striped table-bordered table-hover" id="DerivaMoveTable">
                                  <thead>
                                    <tr class="header">
                                      <!--<th>Invest</th>-->
                                      <th> Derivativo</th>
                                      <th>Status </th>
                                      <th>Corretora</th>
                                      <th>Tipo</th>
                                      <th>Quant</th>
                                      <th>Resultado</th>
                                      <th colspan="2"></th>
                                    </tr>
                                  </thead>
                                
                                  <tbody>
                                    <% @deriva_moves.order("created_at desc").where(:carteira_id => @carteira.id).where(:vencimento_id => vencimento.id).each do |dm| %>
                                    <tr>
                                        <td><%= dm.codigo %></td>
                                        <td><%= dm.estado.status %></td>
                                        <td><%= dm.corretora.nome %></td>
                                        <td><%= dm.deriva_tipo.tipo %></td>
                                        <td><%= dm.quantidade %></td>
                                        <td style="width: 145px;">
                                            <span class="text-primary"><%= number_to_currency(resultado_aberta(dm), unit: "R$ ", separator: ",", delimiter: ".", strip_insignificant_zeros: true) %></span>
                                            <span class="text-primary"><%= number_to_currency(resultado_po(dm), unit: "R$ ", separator: ",", delimiter: ".", strip_insignificant_zeros: true) %></span>
                                            <span class="text-primary"><% if dm.strike.present? %><%= number_to_currency(resultado_exercicio(dm), unit: "R$ ", separator: ",", delimiter: ".", strip_insignificant_zeros: true) %><% end %></span>
                                            <span class="text-<%= cor_resultado_recompra(dm) %>"><%= number_to_currency(resultado_recompra(dm), unit: "R$ ", separator: ",", delimiter: ".", strip_insignificant_zeros: true) %></span>
                                            
                                        </td>
                                        <td><%= link_to 'Edit', edit_deriva_move_path(dm) %></td>
                                        <td><%= link_to 'Destroy', dm, method: :delete, data: { confirm: 'Are you sure?' } %></td>
                                        
                                      </tr>
                                    <% end %>
                                  </tbody>
                            </table>
                        </div>
                     </div>
                  </div>
               </div>

            <% end %>
        <% end %>
        </div>
    </div>
</div>

            
               
               
            


